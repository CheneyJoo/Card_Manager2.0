
@{
    Layout = null;
    List<Model.KeyValueModel> qyList = ViewBag.QyList;

    List<Model.XttcbModel> tcList = ViewBag.TcList;
    List<Model.PqPjtcModel> pjtcList = ViewBag.PjtcList;
}
@model Model.PqQyszModel
<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link rel="stylesheet" href="~/Content/assets/css/layui.css">
    <link rel="stylesheet" href="~/Content/assets/font2/iconfont.css">
    <link rel="stylesheet" href="~/Content/assets/css/view.css" />
    <link rel="stylesheet" href="~/Content/assets/css/admin.css" />
    <link rel="icon" href="/favicon.ico">
    <title></title>
    <style>
        .paiqiTable td { position: relative; }
        .paiqiTable .rest { color: #ff0000; }
        .paiqiTable .normal p { color: #999999; }
            .paiqiTable .normal p span { color: #ffbb00; }
        .paiqiTable .full p { color: #ff0000; }
        .paiqiTable .selected { background-color: #ffbb00; color: #fff !important; }
            .paiqiTable .selected p { color: #fff !important; }
                .paiqiTable .selected p span { color: #fff !important; }
        .paiqiTable .off { background-color: #e5e5e5; }
        .paiqiTable .on { cursor: pointer; }
    </style>

    <style type="text/css">
        .inputW100 input { width: 100% !important; }
        .model_select { width: 630px; position: relative; font-size: 14px; color: #666666; }
            .model_select .hd { min-height: 36px; line-height: 36px; padding: 0 10px; background-color: #fffeff; border-radius: 4px; border: solid 1px #e5e5e5; }
                .model_select .hd > div { display: inline-block; }
                .model_select .hd span { position: relative; background-color: #edeff2; border-radius: 4px; padding: 4px 10px; padding-right: 24px; display: inline-block; line-height: initial; }
                    .model_select .hd span i { position: absolute; width: 14px; height: 14px; background: url(/Content/assets/images/c.png) no-repeat; background-size: 100%; top: 50%; right: 8px; margin-top: -7px; cursor: pointer; }
                .model_select .hd label { margin: 0 4px; display: inline-block; }
            .model_select .bd { position: absolute; width: 628px; left: 0; background-color: #fffeff; border-radius: 4px; border: solid 1px #e5e5e5; display: none; z-index: 10; }
        .model_selected .bd { display: block; }
        .model_select .bd li { height: 32px; line-height: 32px; padding: 0 10px; cursor: pointer; }
            .model_select .bd li.on { background: #e9f1ff; }
        .model_select .layui-edge { position: absolute; right: 10px; top: 50%; margin-top: -3px; cursor: pointer; border-width: 6px; border-top-color: #c2c2c2; border-top-style: solid; transition: all .3s; -webkit-transition: all .3s; }
        .model_selected .layui-edge { margin-top: -9px; -webkit-transform: rotate(180deg); transform: rotate(180deg); }
        .model_select .holder_p { color: #b2b2b2; }
    </style>

</head>
<body class="layui-view-body">
    <style>
        .edit_dialog .box-block { margin-bottom: 16px; }
        .edit_dialog .layui-input-inline3 input { width: 110px; }
        .edit_dialog .box-inline { display: inline-block; }
        .edit_dialog .layui-input-inline { margin: 0 10px; float: none; width: auto; }
        .edit_dialog .layui-input-inline2 input { width: 60px; }
        .edit_dialog .cut { display: inline-block; width: 16px; text-align: center; height: 16px; line-height: 15px; font-size: 20px; border-radius: 50%; color: #f5222d; cursor: pointer; border: solid 1px #f8767b; }
        .edit_dialog .addBtn { height: 32px; text-align: center; line-height: 32px; border-radius: 4px; color: #1f77ef; cursor: pointer; border: dashed 1px #dedede; }
        .btn-editpjtc { padding:0 10px;    color: #1f77ef;    border: 1px solid #1f77ef;margin-left:12px}
        .btn-editpjtc:hover { color: #1f77ef;  }
    </style>

    <form id="form2">
        <!-- 编辑弹窗 -->
        <div class="edit_dialog" id="dialog_edit">
            <div class="layui-form">
                <input type="hidden" id="pqbh2" name="pqbh" />
                <div class="layui-form-item">
                    <label class="layui-form-label">体检日期：</label>
                    <div class="layui-input-inline" style="width:200px;">
                        <input type="text" class="layui-input" value="" disabled style="background: #f5f5f5;" id="setDay">
                    </div>
                </div>
                <div class="layui-form-item">
                    <div><label class="layui-form-label">号源设置&nbsp;&nbsp;&nbsp;</label></div>
                    <div class="layui-clear"></div>
                    <div class="addBtn" style="width: 500px;margin-left:26px">
                        <i class="layui-icon"></i>
                        <span>添加</span>
                    </div>
                </div>

                <div class="buttonwrap">
                    <button class="layui-btn layui-btn-blue yes" style="width: auto;" lay-submit="" lay-filter="save2" id="save2">确定</button>
                </div>
            </div>
        </div>
    </form>

    <form id="form3">
        <!-- 追加截止日期 -->
        <div class="edit_dialog" id="dialog_zj">
            <div class="layui-form">
                <input type="hidden" id="pqbh3" name="pqbh" value="@Model.pqbh" />
                <div class="layui-form-item">
                    <label class="layui-form-label">追加日期：</label>
                    <div class="layui-input-inline" style="width:200px;">
                        <input type="text" class="layui-input" id="jssj" name="jssj" placeholder="请选择">
                    </div>
                </div>
                <div class="buttonwrap">
                    <button class="layui-btn layui-btn-blue yes" style="width: auto;" lay-submit="" lay-filter="save3" id="save3">确定</button>
                </div>
            </div>
        </div>
    </form>

    <form id="form1" class="layui-form">
        <div class="layui-content">
            <div class="layui-page-header">
                <div class="pagewrap">
                    <span class="layui-breadcrumb">
                        <a>企业团检管理</a></a>
                        <a class="on">排期设置</a>
                    </span>
                </div>
            </div>
            <div id="pqsz_wrap">
                <div class="layui-row layui-col-space30">
                    <div class="layui-col-md6 layui-form">
                        <input type="hidden" id="pqbh" name="pqbh" value="@Model.pqbh" />
                        <div>
                            <div class="box-item">
                                <div class="box-title">企业设置</div>
                                <div class="layui-input-inline">
                                    <select lay-filter="qybh" @(string.IsNullOrEmpty(Model.pqbh) ? "" : "disabled") lay-verify="required">
                                        <option value="">请选择企业</option>
                                        @foreach (var item in qyList)
                                        {
                                            <option value="@item.key" @(Model.qybh == item.key ? "selected" : "")>@item.values</option>
                                        }
                                    </select>
                                    <input type="hidden" name="qybh" id="qybh" value="@Model.qybh" />
                                </div>
                            </div>
                            <div class="box-item">
                                <div class="box-title">选择号源时间区间和号源</div>
                                <div class="box-inline" style="width:216px">
                                    <input type="text" class="layui-input" id="rq" name="rq" value="@(string.IsNullOrEmpty(Model.pqbh)?"": (Model.ksrq.ToString("yyyy-MM-dd")+" ~ "+ Model.jsrq.ToString("yyyy-MM-dd")))" lay-verify="required">
                                </div>
                                @if (!string.IsNullOrEmpty(Model.pqbh))
                                {
                                    <input type="button" id="btnzj" value="追加排期" />
                                }
                            </div>
                            <div class="box-item box-yysz" id="hySet">
                                <div class="box-title">号源设置</div>
                                @for (int i = 0; i < Model.SjdList.Count; i++)
                                {
                                    <div class="box-block">
                                        <div class="box-inline">
                                            <label class="box-label">时间段：</label>
                                            <div class="layui-input-inline layui-input-inline3">
                                                <input type="text" readonly class="layui-input" id="kssj@(i)" name="kssj" lay-verify="required|kssj" value="@Model.SjdList[i].kssj" />
                                            </div>
                                            <label class="box-label" style="margin-right: 0;">~</label>
                                            <div class="layui-input-inline layui-input-inline3">
                                                <input type="text" readonly class="layui-input" id="jssj@(i)" name="jssj" lay-verify="required|jssj" value="@Model.SjdList[i].jssj" />
                                            </div>
                                        </div>
                                        <div class="box-inline">
                                            <label class="box-label">每日号源数量</label>
                                            <div class="layui-input-inline layui-input-inline2">
                                                <input type="number" class="layui-input" name="tjrs" value="@(string.IsNullOrEmpty(Model.SjdList[i].kssj)?"":Model.SjdList[i].tjrs.ToString())" min="0" lay-verify="required" />
                                            </div>
                                        </div>
                                        @if (ViewBag.type == 1)
                                        {
                                        <div class="box-inline " style="display:none">
                                            <label class="box-label">到院号源</label>
                                            <div class="layui-input-inline layui-input-inline2">
                                                <input  class="layui-input" name="tjrs_dy" value="@(string.IsNullOrEmpty(Model.SjdList[i].kssj) ? "0" : Model.SjdList[i].tjrs_dy.ToString())" min="0" lay-verify="required" />
                                            </div>
                                        </div>
                                        }
                                        else
                                        {
                                            <input type="hidden" class="layui-input" name="tjrs_dy" value="@(string.IsNullOrEmpty(Model.SjdList[i].kssj) ? "0" : Model.SjdList[i].tjrs_dy.ToString())" min="0" lay-verify="required" />
                                        }
                                        @if (i > 0)
                                        {
                                            <div class="box-inline">
                                                <span class="cut">-</span>
                                            </div>
                                        }
                                    </div>
                                }

                                <div class="addBtn" style="width: 532px;">
                                    <i class="layui-icon">&#xe654;</i>
                                    <span>添加</span>
                                </div>
                            </div>


                            <div class="box-item">
                                <div class="box-title">休息日设置</div>
                                <div class="checkes_wrap">
                                    <input type="checkbox" name="xxr" title="周一" value="1" lay-skin="primary" @(Model.xxr.Split('|').Contains("1") ? "checked" : "") />
                                    <input type="checkbox" name="xxr" title="周二" value="2" lay-skin="primary" @(Model.xxr.Split('|').Contains("2") ? "checked" : "") />
                                    <input type="checkbox" name="xxr" title="周三" value="3" lay-skin="primary" @(Model.xxr.Split('|').Contains("3") ? "checked" : "") />
                                    <input type="checkbox" name="xxr" title="周四" value="4" lay-skin="primary" @(Model.xxr.Split('|').Contains("4") ? "checked" : "") />
                                    <input type="checkbox" name="xxr" title="周五" value="5" lay-skin="primary" @(Model.xxr.Split('|').Contains("5") ? "checked" : "") />
                                    <input type="checkbox" name="xxr" title="周六" value="6" lay-skin="primary" @(Model.xxr.Split('|').Contains("6") ? "checked" : "") />
                                    <input type="checkbox" name="xxr" title="周日" value="0" lay-skin="primary" @(Model.xxr.Split('|').Contains("0") ? "checked" : "") />
                                </div>
                            </div>
                            <div class="box-item box-yysz">
                                <div class="box-title">预约设置</div>
                                <div class="box-block">
                                    需提前
                                    <div class="layui-input-inline layui-input-inline2">
                                        <input id="tqts" name="tqts" type="number" class="layui-input" value="@Model.tqts" min="0" lay-verify="required">
                                    </div>天预约，且在
                                    <div class="layui-input-inline layui-input-inline3">
                                        <input id="jzsj" name="jzsj" type="text" class="layui-input" value="@Model.jzsj" readonly lay-verify="required">
                                    </div>点之前预约
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="layui-col-md6">
                        <div>
                            <div class="layui-form paiqiTop">
                                <div class="item">
                                    <div class="layui-input-inline" style="width: 110px;">
                                        <select id="selectYear" lay-filter="selectYear">
                                            @for (int i = 2019; i <= 2029; i++)
                                            {
                                                <option value="@i" @(DateTime.Now.Year == i ? "selected" : "")>@(i)年</option>
                                            }
                                        </select>
                                    </div>
                                </div>
                                <div class="item tool">
                                    <a href="javascript:;" id="m_left"><i class="layui-icon">&#xe603;</i></a>
                                    <div class="layui-input-inline" style="width: 80px;margin: 0 8px;">
                                        <select id="selectMonth" lay-filter="selectMonth">
                                            @for (int i = 1; i <= 12; i++)
                                            {
                                                <option value="@i" @(DateTime.Now.Month == i ? "selected" : "")>@(i)月</option>
                                            }
                                        </select>
                                    </div>
                                    <a href="javascript:;" id="m_right"><i class="layui-icon">&#xe602;</i></a>
                                </div>
                            </div>
                            <div class="comPaiqiWrap">
                                <table class="paiqiTable">
                                    <thead>
                                        <tr>
                                            <th class="color_red">日</th>
                                            <th>一</th>
                                            <th>二</th>
                                            <th>三</th>
                                            <th>四</th>
                                            <th>五</th>
                                            <th class="color_red">六</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        @{ var gNum = 0;}

                                        @for (int i = 0; i < 6; i++)
                                        {
                                            <tr>
                                                @for (int j = 0; j < 7; j++)
                                                {
                                                    gNum = i * 7 + j;
                                                    <td id="GD@(gNum)">
                                                        <h4 id="SD@(gNum)"></h4>
                                                        <p id="LD@(gNum)"></p>
                                                        <div id="btn@(gNum)" class="tips">
                                                            <div class="set_div">更改设置</div>
                                                            <div class="rest_div">设置休息</div>
                                                            <div class="full_div">设置约满</div>
                                                        </div>
                                                    </td>
                                                }
                                            </tr>
                                        }
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="layui-row">
                    @*<div class="box-item" id="pjtcSet">
                            <div class="box-title">瓶颈套餐号源设置</div>
                            <div class="addBtn">
                                <i class="layui-icon">&#xe654;</i>
                                <span>添加</span>
                            </div>
                        </div>*@
                    <div class="box-item" id="pjtcSet">
                        <div class="box-title">瓶颈套餐号源规则设置</div>
                        @foreach (var item in pjtcList.GroupBy(x => x.fzbh).OrderBy(x => x.FirstOrDefault().fzbh))
                        {
                            <div class="box-block pjtc">
                                <div class="box-inline">
                                    <label class="box-label ruleTxt">规则一：</label>
                                    <div class="layui-input-inline model_select">
                                        <div class="hd">
                                            @for (int i = 0; i < item.Count(); i++)
                                            {
                                                if (i == 0)
                                                {
                                                    <div class="c"><span>@(tcList.FirstOrDefault(x => x.tcbh == item.ToList()[i].tcbh).tcmc)<i></i></span><div></div></div>
                                                }
                                                else
                                                {
                                                    <div class="c"><label>+</label><span>@(tcList.FirstOrDefault(x => x.tcbh == item.ToList()[i].tcbh).tcmc)<i></i></span><div></div></div>
                                                }
                                            }
                                        </div>
                                        <ul class="bd">
                                            @foreach (var tc in tcList)
                                            {
                                                <li tcid="@tc.tcbh" class="@(item.Select(y=>y.tcbh).Contains(tc.tcbh)?"on":"")">@tc.tcmc</li>
                                            }
                                        </ul>
                                        <i class="layui-edge"></i>
                                        <input type="hidden" name="pjtc" value="@string.Join(",",item.Select(y=>y.tcbh).ToArray())" lay-verify="required" lay-reqtext="请选择瓶颈套餐" />
                                    </div>
                                </div>
                                <div class="box-inline">
                                    <label class="box-label">号源数量</label>
                                    <div class="layui-input-inline layui-input-inline2">
                                        <input type="number" class="layui-input" name="pjtcrs" value="@item.FirstOrDefault().tjrs" lay-verify="required">
                                    </div>
                                    <a class="layui-btn layui-btn-primary btn-editpjtc" onclick="EditPjtc(this)">编辑</a>
                                    <input type="hidden" name="pjtcXxr" value="@item.FirstOrDefault().xxr" />
                                    <input type="hidden" name="pjtcSfxz" value="@item.FirstOrDefault().sfxz" />
                                </div>
                                <div class="box-inline">
                                    <span class="cut">-</span>
                                </div>
                            </div>
                        }
                        <div class="addBtn" style="width: 698px;">
                            <i class="layui-icon"></i>
                            <span>添加</span>
                        </div>
                    </div>
                </div>
            </div>
            <div class="c_btns_center">
                <button class="layui-btn layui-btn-blue" lay-submit="" lay-filter="save" id="save">保存</button>
                <a class="layui-btn layui-btn-blue" href='@(Url.Content("~/ScheduleQy/list?type=")+ViewBag.type)'>返回</a>
            </div>
        </div>
    </form>
    <!-- 编辑弹窗 -->
    <form id="form5">
        <div class="edit_dialog" id="dialog_pjtc">
            <div class="layui-form">
                <div class="layui-form-item">
                    <label style="vertical-align:middle;display:inline-block">是否受总号源限制：</label>
                    <div class="layui-input-inline">
                        <input type="radio" name="sfszhyxz" title="是" value="1" checked />
                        <input type="radio" name="sfszhyxz" title="否" value="0" />
                    </div>
                </div>
                <div class="layui-form-item">
                    <div>设定套餐不可约日期：</div>
                    <div>
                        <input type="checkbox" name="xxr_pjtc" title="周一" value="1" lay-skin="primary" />
                        <input type="checkbox" name="xxr_pjtc" title="周二" value="2" lay-skin="primary" />
                        <input type="checkbox" name="xxr_pjtc" title="周三" value="3" lay-skin="primary" />
                        <input type="checkbox" name="xxr_pjtc" title="周四" value="4" lay-skin="primary" />
                        <input type="checkbox" name="xxr_pjtc" title="周五" value="5" lay-skin="primary" />
                        <input type="checkbox" name="xxr_pjtc" title="周六" value="6" lay-skin="primary" />
                        <input type="checkbox" name="xxr_pjtc" title="周日" value="0" lay-skin="primary" />
                    </div>
                </div>

                <div class="buttonwrap">
                    <a href="javascript:qrxg();" class="layui-btn layui-btn-blue yes" style="width: auto;" id="qrxg">确定</a>
                </div>
            </div>
        </div>
    </form>
    <script src="~/Scripts/jquery-1.8.2.min.js"></script>
    <script src="~/Content/assets/layui.all.js"></script>
    <script>

        $("#hySet .addBtn").click(function () {
            sjdCount++;
            var html = "";
            html += '<div class="box-block">';
            html += '<div class="box-inline">';
            html += '<label class="box-label">时间段：</label>';
            html += ' <div class="layui-input-inline layui-input-inline3">';
            html += '<input readonly type="text" class="layui-input" id="kssj'+sjdCount+'" name="kssj" lay-verify="required|kssj" >';
            html += '</div>';
            html += ' <label class="box-label" style="margin-right: 0;">~</label> ';
            html += '<div class="layui-input-inline layui-input-inline3">';
            html += '<input readonly type="text" class="layui-input" id="jssj'+sjdCount+'" name="jssj" lay-verify="required|kssj" >';
            html += '</div>';
            html += '</div>';
            //html += '</div>';
            html += ' <div class="box-inline">';
            html += ' <label class="box-label">每日号源数量</label> ';
            html += ' <div class="layui-input-inline layui-input-inline2">';
            html += ' <input type="number" class="layui-input" name="tjrs" min="0" lay-verify="required">';
            html += '</div>';
            html += '</div>';
            html+=  '<input type="hidden" class="layui-input" name="tjrs_dy" value="0" />';
            html += ' <div class="box-inline">';
            html += '<span class="cut">-</span>';
            html += '</div>';
            html += '</div>';
            $(this).before(html);
            //时间选择器
            laydate.render({
                elem: '#kssj'+sjdCount
              , type: 'time'
                //,min: '09:30:00'
            });
            laydate.render({
                elem: '#jssj' + sjdCount
              , type: 'time'
            });
        })

        $(".edit_dialog .addBtn").click(function () {
            sjdCount++;
            var html = "";
            html += '<div class="box-block dialog-sjd">';
            html += '<div class="box-inline">';
            html += '<label class="box-label" style="margin-left:28px">时间段：</label>';
            html += ' <div class="layui-input-inline layui-input-inline3">';
            html += '<input readonly type="text" class="layui-input" id="kssj'+sjdCount+'" name="kssj" lay-verify="required|kssj" >';
            html += '</div>';
            html += ' <label class="box-label" style="margin-right: 0;">~</label> ';
            html += '<div class="layui-input-inline layui-input-inline3">';
            html += '<input readonly type="text" class="layui-input" id="jssj'+sjdCount+'" name="jssj" lay-verify="required|kssj" >';
            html += '</div>';
            html += '</div>';
            //html += '</div>';
            html += ' <div class="box-inline">';
            html += ' <label class="box-label">每日号源数量</label> ';
            html += ' <div class="layui-input-inline layui-input-inline2">';
            html += ' <input type="number" class="layui-input" name="tjrs" min="0" lay-verify="required">';
            html += '</div>';
            html += '</div>';
            html+=  '<input type="hidden" class="layui-input" name="tjrs_dy" value="0" />';
            html += ' <div class="box-inline">';
            html += '<span class="cut">-</span>';
            html += '</div>';
            html += '</div>';
            $(this).before(html);
            //时间选择器
            laydate.render({
                elem: '#kssj'+sjdCount,
                type: 'time',
                //min: '09:30:00'
            });
            laydate.render({
                elem: '#jssj' + sjdCount
              , type: 'time'
            });
        })
        layui.use('laydate', function () {
            var laydate = layui.laydate;
            //执行一个laydate实例
            laydate.render({
                elem: '#jssj' //指定元素
            });

        });
    </script>
    <script>
        //追加操作
        $("#btnzj").click(function () {


            i = layer.open({
                type: 1,
                title: ['追加设置', 'font-weight:bold;font-size:16px'],
                area: '620px',
                offset: '120px',
                //area: ['auto', 'auto'],
                content: $('#dialog_zj'),
                cancel: function () {
                    $('#dialog_zj').hide()
                }
            })
        })



        //编辑操作
        $(".set_div").click(function () {
            $(".dialog-sjd").remove();
            var day = $(this).parents("td").attr("day");
            var num = $(this).parents("td").attr("num");
            var date = (year + "-" + Checknumber(month) + "-" + Checknumber(day));
            $("#setDay").val(date);
            $("#pqbh2").val( $(this).parents("td").attr("pqbh"));
            var qybh=$("#qybh").val();
            $.ajax({
                url:"@Url.Action("GetTjsj", "ScheduleQy")",
                data:{qybh:qybh,rq:date},
                dataType:"json",
                type:"post",
                success:function(res){

                    $.each(res,function(i,item){
                        var html = "";
                        sjdCount++;
                        html += '<div class="box-block dialog-sjd">';
                        html += '<div class="box-inline">';
                        html += '<label class="box-label" style="margin-left:28px">时间段：</label>';
                        html += ' <div class="layui-input-inline layui-input-inline3">';
                        html += '<input readonly type="text" class="layui-input" id="kssj'+sjdCount+'" name="kssj" value="'+item.kssj+'" lay-verify="required|kssj" >';
                        html += '</div>';
                        html += ' <label class="box-label" style="margin-right: 0;">~</label> ';
                        html += '<div class="layui-input-inline layui-input-inline3">';
                        html += '<input readonly type="text" class="layui-input" id="jssj'+sjdCount+'" name="jssj" value="'+item.jssj+'" lay-verify="required|kssj" >';
                        html += '</div>';
                        html += '</div>';
                        //html += '</div>';
                        html += ' <div class="box-inline">';
                        html += ' <label class="box-label">每日号源数量</label> ';
                        html += ' <div class="layui-input-inline layui-input-inline2">';
                        html += ' <input type="number" class="layui-input" name="tjrs" min="0" value="'+item.tjrs+'" lay-verify="required">';
                        html += '</div>';
                        html += '</div>';
                        if(i>0){
                            html += ' <div class="box-inline">';
                            html += '<span class="cut">-</span>';
                            html += '</div>';
                        }
                        html += '</div>';
                        $(".edit_dialog .addBtn").before(html);
                        laydate.render({
                            elem: '#kssj'+sjdCount,
                            type: 'time'
                        });
                        laydate.render({
                            elem: '#jssj' + sjdCount,
                            type: 'time'
                        });
                    })
                }
            })

            i = layer.open({
                type: 1,
                title: ['更改设置', 'font-weight:bold;font-size:16px'],
                area: '620px',
                offset: '120px',
                //area: ['auto', 'auto'],
                content: $('#dialog_edit'),
                cancel: function () {
                    $('#dialog_edit').hide()
                }
            })
        })




        var year = '@DateTime.Now.Year', month = '@DateTime.Now.Month', today = new Date('@DateTime.Now.ToString("yyyy-MM-dd")');

        $(function () {
            GetSchedule();
            form.on('select(selectYear)', function (data) {
                year = $("#selectYear").val();
                month = $("#selectMonth").val();
                GetSchedule();
            })

            form.on('select(selectMonth)', function (data) {
                year = $("#selectYear").val();
                month = $("#selectMonth").val();
                GetSchedule();
            })
        })

        $(".full_div,.rest_div").click(function () {
            var day = $(this).parents("td").attr("day");
            var flag = $(this).parents("td").attr("flag");
            var newFlag = flag;
            if ($(this).hasClass("rest_div")) {
                newFlag = flag == 1 ? 0 : 1;
            } else if ($(this).hasClass("full_div")) {
                newFlag = flag == 2 ? 0 : 2;
            }
            var rq = year + "-" + month + "-" + day;
            $.ajax({
                url: "@Url.Action("ChangeFlag")",
                data: { qybh: $("#qybh").val(), rq: rq, flag: newFlag },
                type: "post",
                dataType: "json",
                success: function (res) {
                    GetSchedule();
                }
            })

        })

        $(".paiqiTable tbody td").click(function (e) {
            $(".tips").hide();
            if ($(this).hasClass("on")) {
                $(this).find(".tips").show();
            }
        });
        $(".paiqiTable tbody td").mouseleave(function (e) {
            $(this).find(".tips").hide();
        });

        function GetSchedule() {
            $(".tips").hide();
            if ($("#qybh").val() == "") {
                drawCld(year, month - 1, {});
            } else {
                $.ajax({
                    url: '@Url.Content("~/ScheduleQy/GetSchedule")',
                    data: { year: year, month: month, qybh: $("#qybh").val() },
                    dataType: "json",
                    type: "post",
                    success: function (res) {
                        drawCld(year, month - 1, res);
                    }
                })
            }
        }


        var lunarInfo = new Array(
       0x04bd8, 0x04ae0, 0x0a570, 0x054d5, 0x0d260, 0x0d950, 0x16554, 0x056a0, 0x09ad0, 0x055d2,
       0x04ae0, 0x0a5b6, 0x0a4d0, 0x0d250, 0x1d255, 0x0b540, 0x0d6a0, 0x0ada2, 0x095b0, 0x14977,
       0x04970, 0x0a4b0, 0x0b4b5, 0x06a50, 0x06d40, 0x1ab54, 0x02b60, 0x09570, 0x052f2, 0x04970,
       0x06566, 0x0d4a0, 0x0ea50, 0x06e95, 0x05ad0, 0x02b60, 0x186e3, 0x092e0, 0x1c8d7, 0x0c950,
       0x0d4a0, 0x1d8a6, 0x0b550, 0x056a0, 0x1a5b4, 0x025d0, 0x092d0, 0x0d2b2, 0x0a950, 0x0b557,
       0x06ca0, 0x0b550, 0x15355, 0x04da0, 0x0a5d0, 0x14573, 0x052d0, 0x0a9a8, 0x0e950, 0x06aa0,
       0x0aea6, 0x0ab50, 0x04b60, 0x0aae4, 0x0a570, 0x05260, 0x0f263, 0x0d950, 0x05b57, 0x056a0,
       0x096d0, 0x04dd5, 0x04ad0, 0x0a4d0, 0x0d4d4, 0x0d250, 0x0d558, 0x0b540, 0x0b5a0, 0x195a6,
       0x095b0, 0x049b0, 0x0a974, 0x0a4b0, 0x0b27a, 0x06a50, 0x06d40, 0x0af46, 0x0ab60, 0x09570,
       0x04af5, 0x04970, 0x064b0, 0x074a3, 0x0ea50, 0x06b58, 0x055c0, 0x0ab60, 0x096d5, 0x092e0,
       0x0c960, 0x0d954, 0x0d4a0, 0x0da50, 0x07552, 0x056a0, 0x0abb7, 0x025d0, 0x092d0, 0x0cab5,
       0x0a950, 0x0b4a0, 0x0baa4, 0x0ad50, 0x055d9, 0x04ba0, 0x0a5b0, 0x15176, 0x052b0, 0x0a930,
       0x07954, 0x06aa0, 0x0ad50, 0x05b52, 0x04b60, 0x0a6e6, 0x0a4e0, 0x0d260, 0x0ea65, 0x0d530,
       0x05aa0, 0x076a3, 0x096d0, 0x04bd7, 0x04ad0, 0x0a4d0, 0x1d0b6, 0x0d250, 0x0d520, 0x0dd45,
       0x0b5a0, 0x056d0, 0x055b2, 0x049b0, 0x0a577, 0x0a4b0, 0x0aa50, 0x1b255, 0x06d20, 0x0ada0
   )

        var solarMonth = new Array(31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31);
        var nStr1 = new Array('日', '一', '二', '三', '四', '五', '六', '七', '八', '九', '十');



        //返回农历y年的总天数
        function lYearDays(y) {
            var i, sum = 348;
            for (i = 0x8000; i > 0x8; i >>= 1) sum += (lunarInfo[y - 1900] & i) ? 1 : 0;
            return (sum + leapDays(y));
        }
        //返回农历y年闰月的天数
        function leapDays(y) {
            if (leapMonth(y)) return ((lunarInfo[y - 1900] & 0x10000) ? 30 : 29);
            else return (0);
        }
        //判断y年的农历中那个月是闰月,不是闰月返回0
        function leapMonth(y) {
            return (lunarInfo[y - 1900] & 0xf);
        }
        //返回农历y年m月的总天数
        function monthDays(y, m) {
            return ((lunarInfo[y - 1900] & (0x10000 >> m)) ? 30 : 29);
        }
        //算出当前月第一天的农历日期和当前农历日期下一个月农历的第一天日期
        function Dianaday(objDate) {

            var i, leap = 0, temp = 0;
            var baseDate = new Date(1900, 0, 31);
            var offset = (objDate - baseDate) / 86400000;
            this.dayCyl = offset + 40;
            this.monCyl = 14;
            for (i = 1900; i < 2050 && offset > 0; i++) {
                temp = lYearDays(i)
                offset -= temp;
                this.monCyl += 12;
            }
            if (offset < 0) {
                offset += temp;
                i--;
                this.monCyl -= 12;
            }
            this.year = i;
            this.yearCyl = i - 1864;
            leap = leapMonth(i); //闰哪个月
            this.isLeap = false;
            for (i = 1; i < 13 && offset > 0; i++) {
                if (leap > 0 && i == (leap + 1) && this.isLeap == false) {	//闰月
                    --i; this.isLeap = true; temp = leapDays(this.year);
                }
                else {
                    temp = monthDays(this.year, i);
                }
                if (this.isLeap == true && i == (leap + 1)) this.isLeap = false;	//解除闰月
                offset -= temp;
                if (this.isLeap == false) this.monCyl++;
            }
            if (offset == 0 && leap > 0 && i == leap + 1)
                if (this.isLeap) { this.isLeap = false; }
                else { this.isLeap = true; --i; --this.monCyl; }
            if (offset < 0) { offset += temp; --i; --this.monCyl; }
            this.month = i;
            this.day = offset + 1;
        }
        //返回公历y年m+1月的天数
        function solarDays(y, m) {
            if (m == 1)
                return (((y % 4 == 0) && (y % 100 != 0) || (y % 400 == 0)) ? 29 : 28);
            else
                return (solarMonth[m]);
        }
        //记录公历和农历某天的日期
        function calElement(sYear, sMonth, sDay, week, lYear, lMonth, lDay, isLeap) {
            this.isToday = false;
            //公历
            this.sYear = sYear;
            this.sMonth = sMonth;
            this.sDay = sDay;
            this.week = week;
            //农历
            this.lYear = lYear;
            this.lMonth = lMonth;
            this.lDay = lDay;
            this.isLeap = isLeap;
            //节日记录
            this.lunarFestival = ''; //农历节日
            this.solarFestival = ''; //公历节日
            this.solarTerms = ''; //节气
        }

        //保存y年m+1月的相关信息
        var fat = mat = 9;
        var eve = 0;
        function calendar(y, m) {

            fat = mat = 0;
            var sDObj, lDObj, lY, lM, lD = 1, lL, lX = 0, tmp1, tmp2;
            var lDPOS = new Array(3);
            var n = 0;
            var firstLM = 0;
            sDObj = new Date(y, m, 1);	//当月第一天的日期
            this.length = solarDays(y, m);    //公历当月天数
            this.firstWeek = sDObj.getDay();    //公历当月1日星期几
            if ((m + 1) == 5) { fat = sDObj.getDay() }
            if ((m + 1) == 6) { mat = sDObj.getDay() }
            for (var i = 0; i < this.length; i++) {
                if (lD > lX) {
                    sDObj = new Date(y, m, i + 1);    //当月第一天的日期
                    lDObj = new Dianaday(sDObj);     //农历
                    lY = lDObj.year;           //农历年
                    lM = lDObj.month;          //农历月
                    lD = lDObj.day;            //农历日
                    lL = lDObj.isLeap;         //农历是否闰月
                    lX = lL ? leapDays(lY) : monthDays(lY, lM); //农历当月最後一天
                    if (lM == 12) { eve = lX }
                    if (n == 0) firstLM = lM;
                    lDPOS[n++] = i - lD + 1;
                }
                this[i] = new calElement(y, m + 1, i + 1, nStr1[(i + this.firstWeek) % 7], lY, lM, lD++, lL);
                if ((i + this.firstWeek) % 7 == 0) {
                    this[i].color = '#ccc';  //周日颜色
                }
            }

            //if (y == tY && m == tM) this[tD - 1].isToday = true;	//今日
        }

        var cld;

        var Checknumber = function (startmonth) {
            if (new Number(startmonth).toString().length == 1) {
                startmonth = "0" + startmonth;
            }
            return startmonth;
        }
        var restTotalList = null;//每天剩余预约量,(50/100)

        var year = '@DateTime.Now.Year', month = '@DateTime.Now.Month', today = new Date('@DateTime.Now.ToString("yyyy-MM-dd")');
        function drawCld(SY, SM, DtList) {

            var TF = true;
            var p1 = p2 = "";
            var i, sD, s, size;
            cld = new calendar(SY, SM);


            for (i = 0; i < 42; i++) {
                tobj = eval('GD' + i);
                sObj = eval('SD' + i);
                lObj = eval('LD' + i);
                sObj.className = '';
                sD = i - cld.firstWeek;

                if (sD > -1 && sD < cld.length) { //日期内

                    var cldday = sD + 1;

                    val = (year + "-" + Checknumber(month) + "-" + Checknumber(cldday));
                    var cksa = new Date(Date.parse(val));


                    var ckobj = DtList != undefined ? DtList["DT" + cldday] : null;
                    if (!ckobj) {
                        $(tobj).attr("flag", 0).attr("day", cldday);
                        if (cksa >= today) {
                            tobj.className = "";
                        } else {
                            tobj.className = "off";
                        }
                        lObj.innerHTML = "&nbsp;";//未排
                    } else {
                        $(tobj).attr("flag", ckobj.flag).attr("day", cldday).attr("num", ckobj.tjrs).attr("pqbh",ckobj.pqbh);
                        if (cksa >= today) {
                            if (ckobj.flag == "0") {
                                tobj.className = "on normal";
                                lObj.innerHTML = ckobj.tjrs;
                                $(tobj).find(".rest_div").html("设置休息");
                                $(tobj).find(".full_div").html("设置约满");
                            } else if (ckobj.flag == "1") {
                                tobj.className = "on rest";
                                lObj.innerHTML = "休息";
                                $(tobj).find(".rest_div").html("取消休息");
                                $(tobj).find(".full_div").html("设置约满");
                            }
                            else if (ckobj.flag == "2") {
                                tobj.className = "on full";
                                lObj.innerHTML = "约满";
                                $(tobj).find(".rest_div").html("设置休息");
                                $(tobj).find(".full_div").html("取消约满");
                            }
                        } else {
                            if (ckobj.flag == "0") {
                                tobj.className = "normal off";
                                lObj.innerHTML = ckobj.tjrs;
                            } else if (ckobj.flag == "1") {
                                tobj.className = "rest off";
                                lObj.innerHTML = "休息";
                            } else if (ckobj.flag == "2") {
                                tobj.className = "full off";
                                lObj.innerHTML = "约满";
                            }
                        }
                        tobj.setAttribute("title", "");
                    }
                    sObj.innerHTML = cldday;

                    if (i == 35) {
                        $(tobj).parent().show();
                    }
                } else { //非日期
                    tobj.className = "";
                    sObj.innerHTML = '';
                    lObj.innerHTML = '';
                    tobj.setAttribute("title", "");

                    if (i == 35) {
                        $(tobj).parent().hide();
                    }
                }
            }
        }
    </script>
    <script>
        $(document).on("click",".model_select",function() {
            var _this = $(this);
            _this.parents('.box-block').siblings('.box-block').find('.model_select').removeClass('model_selected');
            _this.toggleClass('model_selected');
            return false;
        })
        $(document).on('click','.model_select li',function() {
            var _this = $(this);
            var _text = _this.text();
            var _div = _this.parents('.model_select').find('.c');
            if(_div.length==0){
                _this.parents('.model_select').find(".hd").html("");
            }
            _this.toggleClass('on');
            var _html = '<div class=\'c\'><label>+</label><span>'+_text+'<i></i></span><div>';
            if(_this.hasClass('on')) {
                _this.parents('.model_select').find('.hd').append(_html);
            }else {
                for(var i=0;i<_div.length;i++) {
                    if(_div.eq(i).find('span').text()==_text) {
                        _div.eq(i).remove();
                    }
                }
                if(_this.parents('.bd').find('.on').length==0) {
                    _this.parents('.model_select').removeClass('model_selected');
                }
            }
            _this.parents(".model_select").find(".hd .c:eq(0)").find("label").remove();
            SetPjtc($(this).parents(".pjtc"));
            return false;
        })
        $(document).on('click','.model_select .hd i',function() {
            var _parent=$(this).parents(".pjtc");
            var _this = $(this);
            var _div = _this.parents('.model_select').find('.c');
            var _text = _this.parent().text();

            var _li = _this.parents('.model_select').find('li');

            for(var i=0;i<_li.length;i++) {
                if(_li.eq(i).text()==_text) {
                    _li.eq(i).removeClass('on');
                }
            }
            if(_div.length==1) {
                _this.parents('.model_select').removeClass('model_selected');
            }
            _this.parents('.c').remove();

            if($(_parent).find('.model_select').find('.c').length==0){
                $(_parent).find('.model_select').find(".hd").html('<p class="holder_p">请选择瓶颈套餐</p>');
            }else{
                $(_parent).find(".model_select .hd .c:eq(0)").find("label").remove();
            }

            SetPjtc(_parent);
            return false;
        });
        $(document).click(function() {
            $('.model_select').removeClass('model_selected');
        })
        function SetPjtc(select)
        {
            var list=[];
            $(select).find(".bd li").each(function(i,item){
                if($(item).hasClass("on")){
                    list.push($(item).attr("tcid"));
                }
            })
            $(select).find("input[name='pjtc']").val(list.join(','));
        }
    </script>
    <script>
        /////var pjtcList = JSON.parse('@@  (Json.Encode(Model.pjtcList))'.replace(/&quot;/g, "\""));

        var element = layui.element;
        var table = layui.table;
        var form = layui.form;
        var laydate = layui.laydate;
        laydate.render({
            elem: '#rq',
            range:"~",
        });
        laydate.render({
            elem: '#jzsj',
            type: 'time',
            format: 'HH:mm'
        });

        var sjdCount = @Model.SjdList.Count;

        for (var i = 0; i < sjdCount; i++) {
            laydate.render({
                elem: '#kssj'+(i),
                type: 'time'
            });
            laydate.render({
                elem: '#jssj' + (i),
                type: 'time'
            });
        }

        form.verify({
            //数组的两个值分别代表：[正则匹配、匹配不符时的提示文字]
            jssj: function(value,item){
                var jssj=$(item).val();
                var kssj=$(item).parent().siblings().find("input[name='kssj']").val();
                if(kssj>=jssj){
                    return "结束时间必须大于开始时间";
                }
            },
        });

        var tclist = [];

        $("#pjtcSet .addBtn").click(function () {
            if ($("#qybh").val() == '') {
                layer.msg('请选择企业', { icon: 2, time: 1000 });
                return;
            }
            addPjtc();
        })
        function addPjtc(pjtc) {
            var html = "";
            html += '<div class="box-block pjtc">';
            html+='<div class="box-inline">';
            html+='<label class="box-label ruleTxt">规则：</label>';
            html+=' <div class="layui-input-inline model_select">';
            html+='    <div class="hd"><p class="holder_p">请选择瓶颈套餐</p></div>';
            html+='    <ul class="bd">';
            $.each(tclist,function(i,item){
                html+='        <li tcid="'+item.tcbh+'">'+item.tcmc+'</li>';
            })
            html+='    </ul>';
            html+='    <i class="layui-edge"></i>';
            html+='<input type="hidden" name="pjtc" lay-verify="required" lay-reqtext="请选择瓶颈套餐" />';
            html+='</div>';
            html+='</div>';
            html+=' <div class="box-inline">';
            html+='    <label class="box-label">号源数量</label>';
            html+='    <div class="layui-input-inline layui-input-inline2">';
            html+='        <input type="number" min="0" class="layui-input" name="pjtcrs"  lay-verify="required"/>';
            html+='    </div>';
            html+='    <a class="layui-btn layui-btn-primary btn-editpjtc" onclick="EditPjtc(this)">编辑</a>';
            html+='    <input type="hidden" name="pjtcXxr"  value=""/>';
            html+='    <input type="hidden" name="pjtcSfxz" value="1"/>';
            html+='</div>';
            html+=' <div class="box-inline">';
            html+='    <span class="cut">-</span>';
            html+='</div>';
            html += '</div>';
            $("#pjtcSet .addBtn").before(html);
            SetRuleText();
            //form.render("select")
        }

        $(function () {
            SetRuleText();
            if ($("#qybh").val() != "" )
            {
                GetTc($("#qybh").val());
            }
        })

        form.on('select(qybh)', function (data) {
            $("#qybh").val(data.value);
            $(".pjtc").remove();
            GetTc(data.value)
            if (data.value) {
                GetSchedule();
            }
        });

        $(document).on("click", ".cut", function () {
            $(this).parent().parent().remove();
            SetRuleText();
        })

        function GetTc(qybh) {
            if (qybh != '') {
                $.ajax({
                    url: "@Url.Action("GetTcList")",
                    data: { qybh: qybh },
                    type: "post",
                    dataType: "json",
                    async: false,
                    success: function (res) {
                        tclist = res;
                    }
                })
            } else {
                tclist = [];
            }
        }

        function Valid() {
            var isvalid = true;
            //if ($("#qybh").val() == "" || $("#qybh").val() == 0) {
            //    layer.msg('请选择企业', { icon: 2, time: 1000,anim:6 });
            //    return false;

            //}
            $("#hySet .box-block .box-inline").each(function(i,item){
                var kssj=$(item).find("input[name='kssj']").val();
                var jssj=$(item).find("input[name='kssj']").val();
                if(kssj>=jssj){
                    layer.msg('号源设置结束时间必须大于开始时间', { icon: 2, time: 3000,anim:6 });
                    isvalid = false;
                    return false;
                }
            })
            //if (!isvalid) {
            //    return;
            //}
            return isvalid;


            //$(".pjtc").each(function (i, item) {
            //    if ($(item).find("[name='pjtc']").val() == '') {
            //        layer.msg('请选择瓶颈套餐', { icon: 2, time: 1000,anim:6 });
            //        isvalid = false;
            //        return false;

            //    }
            //    if ($(item).find("[name='pjtcrs']").val() == '') {
            //        layer.msg('瓶颈套餐号源数量不能为空', { icon: 2, time: 1000,anim:6 });
            //        isvalid = false;
            //        return false;

            //    }
            //})
            //if (!isvalid) {
            //    return false;
            //}
            //if ($("#tqts").val() == "") {
            //    layer.msg('请设置提前天数', { icon: 2, time: 1000,anim:6 });
            //    return false;

            //}
            //if ($("#jzsj").val() == "") {
            //    layer.msg('请设置截止预约时间', { icon: 2, time: 1000,anim:6 });
            //    return false;
            //}

            //return true;
        }

        //监听提交
        form.on('submit(save)', function (data) {
            //if(!Valid()){
            //    return false;
            //}
            //$("#save").attr("disabled", true);
            $.ajax({
                url: "@Url.Action("BatchSave")",
                data: $("#form1").serialize(),
                dataType: "json",
                type: "post",
                success: function (res) {
                    if (res.code == 200) {
                        layer.msg('保存成功', {
                            icon: 1, time: 1000, end: function () {
                                window.location.href = '@(Url.Content("~/ScheduleQy/edit/"))'+ res.pqbh;
                            }
                        });
                    } else {
                        layer.msg(res.msg, { icon: 2, time: 1000 });
                        //$("#save").removeAttr("disabled");
                    }
                }
            })
            return false;
        });

        //监听提交
        form.on('submit(save2)', function (data) {
            $.ajax({
                url: "@Url.Action("Save")?tjrq="+$("#setDay").val()+"&qybh="+$("#qybh").val(),
                data: $("#form2").serialize(),
                dataType: "json",
                type: "post",
                success: function (res) {
                    if (res.code == 200) {
                        $("#dialog_edit").hide();
                        layer.close(i);
                        layer.msg('保存成功！', { icon: 1, time: 1000 });
                        GetSchedule();
                    }  else
                    {   layer.msg(res.msg, { icon: 2, time: 1000 });}
                }
            })
            return false;
        });
        //监听提交
        form.on('submit(save3)', function (data) {
            var url= '@(Url.Content("~/ScheduleQy/edit/"))';
            $.ajax({
                url: "@Url.Action("ZjSave")",
                data: $("#form3").serialize(),
                dataType: "json",
                type: "post",
                success: function (res) {
                    if (res.code == 200) {
                        $("#dialog_zj").hide();
                        layer.close(i);
                        layer.msg('保存成功！', { icon: 1, time: 1000,end:function(){
                            window.location.href = url+ res.pqbh;
                        } });
                    }
                    else
                    {   layer.msg(res.msg, { icon: 2, time: 1000 });}
                }
            })
            return false;
        });

        $("#m_left").click(function () {
            year = $("#selectYear").val();
            month = $("#selectMonth").val();
            if (month == 1) {
                if (year > 2019) {
                    month = 12;
                    year = year - 1;
                }
            } else {
                month = month - 1;
            }
            $("#selectYear").val(year);
            $("#selectMonth").val(month);
            form.render("select")
            GetSchedule();
        })
        $("#m_right").click(function () {
            year = $("#selectYear").val();
            month = $("#selectMonth").val();
            if (month == 12) {
                if (year < 2029) {
                    month = 1;
                    year = parseInt(year) + 1;
                }
            } else {
                month = parseInt(month) + 1;
            }
            $("#selectYear").val(year);
            $("#selectMonth").val(month);
            form.render("select")
            GetSchedule();
        })
        $(document).on("input", "input[type='number']", function () {
            if ($(this).val().length > 4) {
                $(this).val($(this).val().slice(0, 4));
            }
        })
        $(document).on("keyup", "input[type='number']", function () {
            var value = $(this).val().replace(/\D/g, '');
            $(this).val(value);
        })

        function toChinesNum(num){
            var changeNum = ['零', '一', '二', '三', '四', '五', '六', '七', '八','九'];
            var unit = ["","十","百", "千", "万"];
            num = parseInt(num);
            var getWan=function(temp){
                var strArr = temp.toString().split("").reverse();
                var newNum = "";
                for (var i = 0; i < strArr.length; i++) {
                    newNum = (i == 0 && strArr[i] == 0 ? "" : (i > 0 && strArr[i] == 0 && strArr[i - 1] == 0 ? "" : changeNum[strArr[i]] + (strArr[i] == 0 ? unit[0] : unit[i]))) + newNum;
                }
                return newNum;
            }

            var overWan = Math.floor(num / 10000);
            var noWan = num % 10000;
            if (noWan.toString().length < 4) noWan = "0" + noWan;
            return overWan ? getWan(overWan) + "万" + getWan(noWan) : getWan(num);
        }

        function SetRuleText(){
            $(".ruleTxt").each(function(i,item){
                $(this).html("规则"+toChinesNum(i+1)+"：");
            })
        }

        var curPjtc;
        function EditPjtc(e){
            curPjtc=e;
            var xxr=$(e).parent().find("input[name='pjtcXxr']").val();
            var sfxz=$(e).parent().find("input[name='pjtcSfxz']").val();
            if(sfxz==1){
                $("[name=sfszhyxz]:eq(0)").prop("checked",true);
                $("[name=sfszhyxz]:eq(1)").prop("checked",false);
            }else{
                $("[name=sfszhyxz]:eq(0)").prop("checked",false);
                $("[name=sfszhyxz]:eq(1)").prop("checked",true);
            }

            $.each($("#dialog_pjtc input[type=checkbox]"),function(i,item){
                $(item).prop("checked",false);
                if(xxr){
                    if(xxr.indexOf("0")>-1&&i==6){
                        $(item).prop("checked",true);
                    }else if(xxr.indexOf("1")>-1&&i==0){
                        $(item).prop("checked",true);
                    }else if(xxr.indexOf("2")>-1&&i==1){
                        $(item).prop("checked",true);
                    }else if(xxr.indexOf("3")>-1&&i==2){
                        $(item).prop("checked",true);
                    }else if(xxr.indexOf("4")>-1&&i==3){
                        $(item).prop("checked",true);
                    }else if(xxr.indexOf("5")>-1&&i==4){
                        $(item).prop("checked",true);
                    }else if(xxr.indexOf("6")>-1&&i==5){
                        $(item).prop("checked",true);
                    }
                }
            })

            form.render("radio");
            form.render("checkbox");
            i = layer.open({
                type: 1,
                title: ['编辑', 'font-weight:bold;font-size:16px'],
                area: ['588px', 'auto'],
                content: $('#dialog_pjtc'),
                cancel: function () {
                    $('#dialog_pjtc').hide();
                }
            });
        }
        function qrxg(){
            var xxr="";
            var sfxz=$("#dialog_pjtc").find("input[name='sfszhyxz']:checked").val();
            var xxrList=[];
            $.each($("#dialog_pjtc input[type=checkbox]:checked"),function(i,item){
                xxrList.push($(item).val());
            })
            xxr=xxrList.join("|");
            $(curPjtc).parent().find("input[name='pjtcXxr']").val(xxr);
            $(curPjtc).parent().find("input[name='pjtcSfxz']").val(sfxz);
            $('#dialog_pjtc').hide();
            layer.close(i);
        }

        $(function(){
            initTime();
        })
        function initTime(){
            for (var i = 0; i < 24; i++) {
                if(i<6){
                    $(".laydate-time-list li:first-child ol li").eq(i).hide();
                }
            }
        }
    </script>
    
</body>
</html>
